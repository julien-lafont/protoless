<html><head><title>protoless</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Julien Lafont" /><meta name="description" content="Type-safe and schema-free Protobuf library for Scala" /><meta name="og:image" content="/protoless/img/poster.png" /><meta name="og:title" content="protoless" /><meta name="og:site_name" content="protoless" /><meta name="og:url" content="https://julien-lafont.github.io/protoless" /><meta name="og:type" content="website" /><meta name="og:description" content="Type-safe and schema-free Protobuf library for Scala" /><link rel="icon" type="image/png" href="/protoless/img/favicon.png" /><meta name="twitter:title" content="protoless" /><meta name="twitter:image" content="https://julien-lafont.github.io/protolessimg/poster.png" /><meta name="twitter:description" content="Type-safe and schema-free Protobuf library for Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@julien_lafont" /><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40626968-2' , 'auto');
ga('send', 'pageview');
      </script><link rel="icon" type="image/png" sizes="16x16" href="/protoless/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/protoless/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/protoless/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/protoless/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/protoless/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/protoless/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/protoless/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/protoless/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/protoless/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/protoless/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/protoless/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/protoless/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/protoless/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/protoless/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/protoless/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/protoless/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/protoless/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/protoless/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/protoless/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/protoless/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/protoless/highlight/styles/atom-one-dark.css" /><link rel="stylesheet" href="/protoless/css/style.css" /><link rel="stylesheet" href="/protoless/css/palette.css" /><link rel="stylesheet" href="/protoless/css/codemirror.css" /><link rel="stylesheet" href="/protoless/css/kazari-style.css" /><link rel="stylesheet" href="/protoless/css/monokai.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/protoless/" class="brand"><div class="brand-wrapper"><span>protoless</span></div></a></li> <li><a href="/protoless/design.html" class="">Library Design</a></li> <li><a href="/protoless/message.html" class="">Message Encoder & Decoder</a></li> <li><a href="/protoless/field.html" class="">Field Encoder & Decoder</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/julien-lafont/protoless"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/julien-lafont/protoless"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('protoless Type-safe and schema-free Protobuf library for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('protoless Type-safe and schema-free Protobuf library for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="julien-lafont" data-github-repo="protoless"><div class="content-wrapper"><section><h1 id="field-encoder--decoder">Field Encoder &amp; Decoder</h1>

<p>Field <a href="/protoless/api/io/protoless/fields/FieldEncoder$.html">encoders</a> and
<a href="/protoless/api/io/protoless/fields/FieldDecoder$.html">decoders</a> are automatically provided by protoless for the following types:</p>

<ul>
  <li><a href="#protobuf-scalar-types">Protobuf scalar types</a>
    <ul>
      <li><a href="#numeric-fields">Numeric fields</a></li>
    </ul>
  </li>
  <li><a href="#optional-fields">Optional fields</a></li>
  <li><a href="#repeated-fields">Repeated fields</a></li>
  <li><a href="#nested-fields">Nested fields</a></li>
  <li><a href="#enumerations">Enumerations</a></li>
  <li><a href="#value-classes">Value classes</a></li>
  <li><a href="#other-scala-types">Other scala types</a></li>
  <li><a href="#create-field-encoder-decoder">Custom field encoder &amp; decoder</a></li>
</ul>

<h2 id="protobuf-scalar-types">Protobuf scalar types</h2>

<table>
  <thead>
    <tr>
      <th>.proto type</th>
      <th>Scala type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>double</td>
      <td>Double</td>
    </tr>
    <tr>
      <td>float</td>
      <td>Float</td>
    </tr>
    <tr>
      <td>int32</td>
      <td>Int</td>
    </tr>
    <tr>
      <td>int64</td>
      <td>Long</td>
    </tr>
    <tr>
      <td>uint32</td>
      <td>Int @@ Unsigned</td>
    </tr>
    <tr>
      <td>uint64</td>
      <td>Long @@ Unsigned</td>
    </tr>
    <tr>
      <td>sint32</td>
      <td>Int @@ Signed</td>
    </tr>
    <tr>
      <td>sint64</td>
      <td>Long @@ Signed</td>
    </tr>
    <tr>
      <td>fixed32</td>
      <td>Int @@ Fixed</td>
    </tr>
    <tr>
      <td>fixed64</td>
      <td>Long @@ Fixed</td>
    </tr>
    <tr>
      <td>sfixed32</td>
      <td>Int @@ Signed with Fixed</td>
    </tr>
    <tr>
      <td>sfixed64</td>
      <td>Long @@ Signed with Fixed</td>
    </tr>
    <tr>
      <td>bool</td>
      <td>Boolean</td>
    </tr>
    <tr>
      <td>string</td>
      <td>String</td>
    </tr>
    <tr>
      <td>bytes</td>
      <td>ByteString</td>
    </tr>
  </tbody>
</table>

<h3 id="numeric-fields">Numeric fields</h3>

<p>Even if <code class="highlighter-rouge">int32</code>, <code class="highlighter-rouge">uint32</code>, <code class="highlighter-rouge">sint32</code>, <code class="highlighter-rouge">fixed32</code> and <code class="highlighter-rouge">sfixed32</code> are all represented as an <code class="highlighter-rouge">Int</code>, it’s required to know
how the numeric field has been encoded in order to decode it with the right algorithm.</p>

<p>protoless uses <a href="http://www.vlachjosef.com/tagged-types-introduction/">tagged type</a> to carry this information
by your model, and provides <a href="/protoless/api/io/protoless/tag/index.html">helpers</a> to tag your data.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.protoless._</span><span class="o">,</span> <span class="n">io</span><span class="o">.</span><span class="n">protoless</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">auto</span><span class="o">.</span><span class="k">_</span><span class="o">,</span> <span class="n">io</span><span class="o">.</span><span class="n">protoless</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="k">_</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">NumericSeries</span><span class="o">(</span><span class="n">uint</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">@@</span> <span class="kt">Unsigned</span><span class="o">,</span> <span class="n">sint</span><span class="k">:</span> <span class="kt">Long</span> <span class="kt">@@</span> <span class="kt">Signed</span><span class="o">,</span> <span class="n">fixed</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">@@</span> <span class="kt">Fixed</span><span class="o">,</span> <span class="n">sfixed</span><span class="k">:</span> <span class="kt">Int</span> <span class="kt">@@</span> <span class="kt">Signed</span> <span class="kt">with</span> <span class="kt">Fixed</span><span class="o">)</span>
</code></pre>
</div>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">serie</span> <span class="k">=</span> <span class="nc">NumericSeries</span><span class="o">(</span>
  <span class="n">uint</span> <span class="k">=</span> <span class="n">unsigned</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
  <span class="n">sint</span> <span class="k">=</span> <span class="n">signed</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span>
  <span class="n">fixed</span> <span class="k">=</span> <span class="n">fixed</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span>
  <span class="n">sfixed</span> <span class="k">=</span> <span class="n">signedFixed</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
<span class="o">)</span>
<span class="c1">// serie: NumericSeries = NumericSeries(1,2,3,4)
</span>
<span class="n">messages</span><span class="o">.</span><span class="nc">Encoder</span><span class="o">[</span><span class="kt">NumericSeries</span><span class="o">].</span><span class="n">encodeAsBytes</span><span class="o">(</span><span class="n">serie</span><span class="o">)</span>
<span class="c1">// res1: Array[Byte] = Array(8, 1, 16, 4, 29, 3, 0, 0, 0, 37, 4, 0, 0, 0)
</span></code></pre>
</div>

<h2 id="optional-fields">Optional fields</h2>

<p>Unlike protocol buffers version 3 which force optional type by default, your model will lay down the law.
You just have to use an <code class="highlighter-rouge">Option</code> if you want to encode/decode an optional field.</p>

<p>Implicit instances of <code class="highlighter-rouge">Option[A]</code> are provided if the type <code class="highlighter-rouge">A</code> has a decoder/encoder instance.</p>

<h2 id="repeated-fields">Repeated fields</h2>

<p>protoless can decode a <code class="highlighter-rouge">repeated</code> field with any uniary subclass of <a href="http://www.scala-lang.org/api/2.12.0/scala/collection/Traversable.html">Traversable</a>:
Seq, List, Set, HashTrieSet, ArrayBuffer… It can also decode cats <a href="https://github.com/typelevel/cats/blob/master/core/src/main/scala/cats/data/NonEmptyList.scala">NonEmptyList</a>
and Java <code class="highlighter-rouge">Array</code>.</p>

<p>Encoders, which are not variant, are a bit more restrictive. protoless provides encoders for <code class="highlighter-rouge">Seq</code>, <code class="highlighter-rouge">immutable.Seq</code>, <code class="highlighter-rouge">List</code>,
<code class="highlighter-rouge">Vector</code>, <code class="highlighter-rouge">Stream</code>, <code class="highlighter-rouge">Array</code> and <code class="highlighter-rouge">NonEmptyList</code>.</p>

<p>You can easily derive new collection encoders:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.protoless.fields._</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable.ArrayBuffer</span>

<span class="k">implicit</span> <span class="k">def</span> <span class="n">encodeArrayBuffer</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">enc</span><span class="k">:</span> <span class="kt">RepeatableFieldEncoder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">FieldEncoder</span><span class="o">[</span><span class="kt">ArrayBuffer</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">FieldEncoder</span><span class="o">.</span><span class="n">deriveFromTraversable</span>
</code></pre>
</div>

<h2 id="nested-fields">Nested fields</h2>

<p>Protocol buffers allows to use the previously defined message as a field type.</p>

<p>protoless operates in the same way: it can encode/decode a field of type <code class="highlighter-rouge">A</code> if there is an implicit instance of
<code class="highlighter-rouge">Encoder[A]</code>/<code class="highlighter-rouge">Decoder[A]</code> in the implicit scope.</p>

<h2 id="enumerations">Enumerations</h2>

<p>Protobuf enumerations can be converted to Scala enumeration, with the constraint that enumerations values must be in the same order.</p>

<div class="language-proto highlighter-rouge"><pre class="highlight"><code><span class="kd">enum</span> <span class="n">Color</span> <span class="p">{</span>
  <span class="na">BLACK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">WHITE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">GREEN</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p><br /></p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">object</span> <span class="nc">Colors</span> <span class="k">extends</span> <span class="nc">Enumeration</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Color</span> <span class="o">=</span> <span class="nc">Value</span>
  <span class="k">val</span> <span class="nc">Black</span><span class="o">,</span> <span class="nc">White</span><span class="o">,</span> <span class="nc">Green</span> <span class="k">=</span> <span class="nc">Value</span>
<span class="o">}</span>
</code></pre>
</div>

<p>An implicit instance for the <code class="highlighter-rouge">encoder</code> will be provided by protoless.</p>

<p>The <code class="highlighter-rouge">decoder</code> must be <strong>explicitly</strong> derived with:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">val</span> <span class="n">colorDecoder</span><span class="k">:</span> <span class="kt">RepeatableFieldDecoder</span><span class="o">[</span><span class="kt">Colors.Value</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FieldDecoder</span><span class="o">.</span><span class="n">decodeEnum</span><span class="o">(</span><span class="nc">Colors</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="value-classes">Value Classes</h2>

<p>Implicit instances of <a href="https://docs.scala-lang.org/overviews/core/value-classes.html">Value Classes</a> are provided if
the underlying type has an encoder/decoder instance.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Money</span><span class="o">(</span><span class="k">val</span> <span class="n">value</span><span class="k">:</span> <span class="kt">BigDecimal</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>
<span class="c1">// defined class Money
</span>
<span class="nc">FieldEncoder</span><span class="o">[</span><span class="kt">Money</span><span class="o">].</span><span class="n">encodeAsBytes</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Money</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="nc">MaxValue</span><span class="o">)))</span> <span class="c1">// I'm rich!
// res1: Array[Byte] = Array(10, 19, 57, 50, 50, 51, 51, 55, 50, 48, 51, 54, 56, 53, 52, 55, 55, 53, 56, 48, 55)
</span></code></pre>
</div>

<h2 id="other-scala-types">Other Scala types</h2>

<p>Implicit instances are provided for the following scala types:</p>

<table>
  <thead>
    <tr>
      <th>Scala type</th>
      <th>Proto representation</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BigDecimal</td>
      <td>string</td>
      <td> </td>
    </tr>
    <tr>
      <td>BigInt</td>
      <td>string</td>
      <td> </td>
    </tr>
    <tr>
      <td>UUID</td>
      <td>repeated sint64</td>
      <td>store 128 bits UUID in two 64 bits long</td>
    </tr>
    <tr>
      <td>Short</td>
      <td>int32</td>
      <td> </td>
    </tr>
    <tr>
      <td>Char</td>
      <td>int32</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h2 id="custom-field-encoder--decoder">Custom field encoder &amp; decoder</h2>

<p>You can create custom encoders/decoders by relying on existing ones, and add your own logic inside them.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Fahrenheit</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">fahrenheitFromCelciusDecoder</span> <span class="k">=</span> <span class="nc">FieldDecoder</span><span class="o">[</span><span class="kt">Float</span><span class="o">].</span><span class="n">map</span><span class="o">(</span><span class="n">celcius</span> <span class="k">=&gt;</span> <span class="nc">Fahrenheit</span><span class="o">((</span><span class="n">celcius</span> <span class="o">*</span> <span class="mf">1.8f</span><span class="o">)</span> <span class="o">+</span> <span class="mi">32</span><span class="o">))</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">fahrenheitToCelciusEncoder</span> <span class="k">=</span> <span class="nc">FieldEncoder</span><span class="o">[</span><span class="kt">Float</span><span class="o">].</span><span class="n">contramap</span><span class="o">[</span><span class="kt">Fahrenheit</span><span class="o">](</span><span class="n">f</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">32</span><span class="o">)</span> <span class="o">/</span> <span class="mf">1.8f</span><span class="o">)</span>
</code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/protoless/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.6/flowchart.min.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'protoless/Lobby'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/protoless/js/main.js"></script><script src="/protoless/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'monokai')
})
    </script></body></html>